"use strict";var express=require("express"),app=express(),bodyParser=require("body-parser"),path=require("path"),server=app.listen(80),io=require("socket.io")(server);app.use(express.static(__dirname,NaN)),app.use(express.static(__dirname,NaN)),app.use(express.static(__dirname,NaN)),app.use(express.static(__dirname,NaN)),app.use(express.static(__dirname+"/public")),app.use(bodyParser.json()),app.use(bodyParser.urlencoded({extended:!0}));var requestDiscount=function(e,s,n){var t=(new Date).getDate();t%5===0?e.requestDiscount=5:t%2===0?e.requestDiscount=2:e.requestDiscount=1,n()};app.use(requestDiscount),app.get("/",function(e,s){s.sendFile("index.html")}),app.get("/discount",function(e,s){s.send(e.requestDiscount+"")}),app.post("/order",function(e,s){var n="";e.on("data",function(e){n+=e.toString()}),e.on("end",function(){s.send(JSON.parse(n))})});var clients={};io.on("connection",function(e){console.log("a user connected"),e.on("disconnect",function(){console.log("user disconnected")});var s=Math.random();clients[s]=e,console.log("новое соединение "+s),e.on("message",function(e){console.log("получено сообщение "+e);for(var s in clients)clients[s].send(e)}),e.on("close",function(){console.log("соединение закрыто "+s),delete clients[s]})});
$(function(){"use strict";function e(){}var t=io("http://localhost:80/");e.prototype.sendGetRequest=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.addEventListener("load",function(){"function"==typeof t&&t(n.response)}),n.addEventListener("error",function(e){console.log(e)}),n.send()},e.prototype.sendPostRequest=function(e,t,n){var i=new XMLHttpRequest;i.open("POST",t,!0),i.addEventListener("load",function(){"function"==typeof n&&n(i.response)}),i.addEventListener("error",function(e){console.log(e)}),i.send(e)},e.prototype.sendSocketRequest=function(e,n){t.send(e),t.on("message",function(e){var t=e;"function"==typeof n&&n(t)})},window.RestaurantAPI=e}),$(function(){"use strict";function e(e,n,i,r,s){this.id=e,this.sName=n,this.name=i,this.spInstruc=r,this.items=[],t(s,this)}function t(e,t){if(e&&0!==e.length)for(var n=0,i=e.length;n<i;n++){var r=new Dish(e[n].id,e[n].short_name,e[n].name,e[n].description,e[n].price_small,e[n].price_large,e[n].small_portion_name,e[n].large_portion_name);t.items.push(r)}}window.Course=e}),$(function(){"use strict";function e(){}var t="snippets/course-empty-snippet.html",n="snippets/course-snippet.html",i=new RestaurantAPI;e.prototype.getCourseHTML=function(){return new Promise(function(e,t){i.sendGetRequest(n,function(t){e(t)})})},e.prototype.getCourseEmptyHTML=function(){return new Promise(function(e,n){i.sendGetRequest(t,function(t){e(t)})})},window.CourseHtml=e}),$(function(){"use strict";function e(e,t,n,i,r,s,o,a){this.id=e,this.sName=t,this.name=n,this.description=i,this.sPrice=r,this.lPrice=s,this.sPortionName=o,this.lPortionName=a,this.sPortionQuant=0,this.lPortionQuant=0}window.Dish=e}),$(function(){"use strict";function e(){}var t="snippets/dish-title-snippet.html",n="snippets/dish-snippet.html",i="snippets/dish-empty-snippet.html",r=new RestaurantAPI;e.prototype.getDishHTML=function(){return new Promise(function(e,t){r.sendGetRequest(n,function(t){e(t)})})},e.prototype.getDishTitleHTML=function(){return new Promise(function(e,n){r.sendGetRequest(t,function(t){e(t)})})},e.prototype.getDishEmptyHTML=function(){return new Promise(function(e,t){r.sendGetRequest(i,function(t){e(t)})})},window.DishHtml=e}),$(function(){"use strict";function e(){}var t="snippets/basket-empty-snippet.html",n="snippets/basket-snippet.html",i="snippets/basket-title-snippet.html",r="snippets/basket-footer-snippet.html",s=new RestaurantAPI;e.prototype.getBasketEmptyHTML=function(){return new Promise(function(e,n){s.sendGetRequest(t,function(t){e(t)})})},e.prototype.getBasketHTML=function(){return new Promise(function(e,t){s.sendGetRequest(n,function(t){e(t)})})},e.prototype.getBasketTitleHTML=function(){return new Promise(function(e,t){s.sendGetRequest(i,function(t){e(t)})})},e.prototype.getBasketFooterHTML=function(){return new Promise(function(e,t){s.sendGetRequest(r,function(t){e(t)})})},e.prototype.getDiscount=function(){return new Promise(function(e,t){s.sendGetRequest("/discount",function(t){e(t)})})},e.prototype.sendOrder=function(e){return new Promise(function(t,n){s.sendPostRequest(e,"/order",function(e){t(e)})})},window.BasketHtml=e}),$(function(){"use strict";function e(){}function t(e){var t=e.target,n=t.parentNode.getAttribute("data-short-name"),i=T.findIndex(function(e){return e.sName===n});if(i>=0){var r=T[i];G(r.id)}else E.getDishEmptyHTML().then(function(e){C.innerHTML=e})}function n(e){var t,n,i,r=e.target;"brand-name"!==r.id&&"logo-img"!==r.id||x(N),r=o(e),t=r.parentNode.parentNode,n=t.querySelectorAll("li");for(var s in Object.keys(n))if(i=n[s].className,i.indexOf("active")!==-1){i=i.replace(new RegExp("active","g"),""),n[s].className=i;break}switch(r.id){case"homeRef":x(N);break;case"menuRef":A("menu.json");break;case"basketRef":J();break;case"historyRef":x(P)}i=r.parentNode.className,i.indexOf("active")==-1&&r.parentNode.classList.add("active")}function i(e){for(var t,n,i,r,s,o=document.getElementsByTagName("input"),a=!1,d=JSON.parse(localStorage.getItem("Order")),u=0,l=o.length;u<l;u++)if("checkbox"===o[u].type&&o[u].checked===!0){t={},n=o[u].parentNode.parentNode.parentNode,i=o[u].parentNode.parentNode.nextSibling.nextSibling.childNodes,r=i[4].value;for(var c=0,m=d.length;c<m;c++)if(Number(d[c].idCourse)===Number(n.getAttribute("data-id-course"))&&Number(d[c].dish.id)===Number(n.getAttribute("data-id"))){d[c].dish.sPortionQuant+=Number(r),a=!0;break}a||(s=I(n.getAttribute("data-id-course"),n.getAttribute("data-id")),s.sPortionQuant=Number(r),t.idCourse=n.getAttribute("data-id-course"),t.dish=s,d.push(t)),o[u].checked=!1,i[4].value="1"}0!==d.length&&localStorage.setItem("Order",JSON.stringify(d))}function r(e){var t,n,i,r,s,o,a=e.target;if(a.classList.contains("delete")){var d=a.nextSibling.nextSibling,u=a.getAttribute("data-id"),l=JSON.parse(localStorage.getItem("Order"));a=e.target.parentNode;for(var c=0,m=l.length;c<m;c++)if(l[c].dish.id===Number(u)){s=null===l[c].dish.sPrice?l[c].dish.sPortionQuant*l[c].dish.lPrice:l[c].dish.sPortionQuant*l[c].dish.sPrice+l[c].dish.lPortionQuant*l[c].dish.lPrice,l.splice(c,1),t=document.getElementById("dollars"),n=document.getElementById("discDollars"),i=document.getElementById("discount"),o=Number(i.innerText.substr(1,i.innerText.length-2)),r=Number(t.innerText.substr(1)),t.innerText="$"+(r-s).toFixed(2),n.innerText="$"+(Number(t.innerText.substr(1))*(1-o/100)).toFixed(2),localStorage.setItem("Order",JSON.stringify(l)),0===l.length?L.getBasketEmptyHTML().then(function(e){C.innerHTML=e}):(a.remove(),d.remove());break}}}function s(e){for(var t,n,i,r,s,o,a,d,u=e.target,l=Number(u.value),c=u.getAttribute("id"),m=u.parentNode.parentNode.parentNode,p=m.getAttribute("data-id"),f=m.getAttribute("data-id-course"),g=u.parentNode.parentNode.nextSibling.nextSibling.childNodes,h=JSON.parse(localStorage.getItem("Order")),v=0,b=h.length;v<b;v++)Number(h[v].idCourse)===Number(f)&&h[v].dish.id===Number(p)&&("pint"===c?(t=h[v].dish.sPrice||h[v].dish.lPrice,n=h[v].dish.sPortionQuant*t,d=g[1],h[v].dish.sPortionQuant=l):"quart"===c&&(t=h[v].dish.lPrice,n=h[v].dish.lPortionQuant*t,d=g[3],h[v].dish.lPortionQuant=l),r=t*l,d.innerHTML="$"+r.toFixed(2),localStorage.setItem("Order",JSON.stringify(h)),i=document.getElementById("dollars"),s=document.getElementById("discDollars"),o=document.getElementById("discount"),a=o.innerText.substr(1,o.innerText.length-2),i.innerText="$"+(Number(i.innerText.substr(1))+(r-n)).toFixed(2),s.innerText="$"+(Number(i.innerText.substr(1))*(1-a/100)).toFixed(2))}function o(e){var t=e.target;return"brand-name"===t.id?t=t.parentNode.parentNode.parentNode.parentNode:"logo-img"===t.id?t=t.parentNode.parentNode.parentNode:"SPAN"===t.tagName&&(t=t.parentNode),t}function a(){var e=window.innerWidth;e<768&&$("#collapsable-nav").collapse("hide")}function d(){var e;"ontransitionstart"in window?($("#modalForm").one("transitionstart",v),e=$("#modalForm"),e.addClass("appear")):($("#modalForm").css("display","block"),e=$("#modalForm"),setTimeout(function(){e.addClass("appear")},300));var t=$("#modalClose"),n=$("#overlay"),i=$("body"),r=$("#eMail"),s=$("#timeDelivery"),o=$("#addressD"),a=$(".ui-timepicker-list"),d=$("#eMailDiv"),m=$("#eMailError"),N=new Date,P=N.getHours(),y=N.getMinutes();i.addClass("modal-open"),r.val(""),s.val(""),o.val(""),y=y>30?30:"00";var C=P-11+":"+y+"pm";s.timepicker({minTime:C,maxTime:"24:00pm"}),s.click(function(){a.css("display","block")}),n.fadeIn(400),t.click(p),n.click(p),$("#sendButton").click(function(){var t=r.val(),p=s.val(),v=o.val(),N=$("#wishes").val();0===t.length&&(d.addClass("submitted"),d.attr("data-email","Please, enter e-mail"),m.addClass("submitted"),m.text("Please, enter e-mail"),r.addClass("submitted"),r.one("input",u)),0===p.length&&($("#timeDiv").addClass("submitted"),s.addClass("submitted"),$("#timeError").addClass("submitted"),s.one("change",l)),0===v.length&&($("#addressDiv").addClass("submitted"),o.addClass("submitted"),$("#addressError").addClass("submitted"),o.one("input",c));var P=$(".ui-timepicker-wrapper").css("display");if("block"!==P&&(0===t.length||g(t)||(d.addClass("submitted"),m.addClass("submitted"),r.addClass("submitted"),d.attr("data-email","Wrong e-mail"),m.text("Wrong e-mail"),r.one("input",u)),0!==t.length&&g(t)&&0!==p.length&&0!==v.length)){f(),e.one("transitionend",h),n.fadeOut(400),i.removeClass("modal-open"),a.css("display","none");for(var y,C,T=JSON.parse(localStorage.getItem("Order")),k=[],w=0,E=T.length;w<E;w++)C={},C.idCourse=T[w].idCourse,C.idDish=T[w].dish.id,C.lPostionQuant=T[w].dish.lPortionQuant,C.sPortionQuant=T[w].dish.sPortionQuant,k.push(C);y={dishes:k,email:t,time:p,address:v,wishes:N},Promise.all([L.sendOrder(JSON.stringify(y)),b(t)]).then(function(e){console.log(e[0]),console.log(e[1])})}})}function u(){$("#eMailDiv").removeClass("submitted"),$("#eMail").removeClass("submitted"),$("#eMailError").removeClass("submitted")}function l(){$("#timeDiv").removeClass("submitted"),$("#timeDelivery").removeClass("submitted"),$("#timeError").removeClass("submitted")}function c(){$("#addressDiv").removeClass("submitted"),$("#addressD").removeClass("submitted"),$("#addressError").removeClass("submitted")}function m(e){e.target.setCustomValidity(" ")}function p(){var e=$("#modalForm");e.removeClass("appear"),e.one("transitionend",h),$("#overlay").fadeOut(400),$("body").removeClass("modal-open"),f(),$(".ui-timepicker-list").css("display","none")}function f(){$("#eMailDiv").removeClass("submitted"),$("#eMail").removeClass("submitted"),$("#timeDiv").removeClass("submitted"),$("#timeDelivery").removeClass("submitted"),$("#addressD").removeClass("submitted"),$("#addressDiv").removeClass("submitted"),$("#eMailError").removeClass("submitted"),$("#timeError").removeClass("submitted"),$("#addressError").removeClass("submitted"),$("#modalForm").removeClass("appear")}function g(e){var t=/\S+@\S+\.\S+/;return t.test(e)}function h(){$("#modalForm").css("display","none"),$("#sendButton").unbind("click"),$("#modalClose").unbind("click"),$("#overlay").unbind("click")}function v(){$("#modalForm").css("display","block")}function b(e){return new Promise(function(t,n){k.sendSocketRequest(e,function(e){t(e)})})}var N="snippets/home-snippet.html",P="snippets/history-snippet.html",y=document.getElementById("container"),C=document.getElementById("main-content");e.prototype=Object.create(Array.prototype,{constructor:{value:e}});var T=new e,k=new RestaurantAPI,w=new CourseHtml,E=new DishHtml,L=new BasketHtml;y.addEventListener("click",n,!1);var x=function(e){k.sendGetRequest(e,function(e){C.innerHTML=e})};x(N),$("#navbarToggle").blur(function(e){setTimeout(a,10)});var M=function(e){return 0!==T.length?T:new Promise(function(t,n){k.sendGetRequest(e,function(e){var n=H(JSON.parse(e));t(n)})})},H=function(e){for(var t=0,n=e.length;t<n;t++){var i=new Course(e[t].id,e[t].short_name,e[t].name,e[t].special_instructions,e[t].menu_items);T.push(i)}return T},S=function(e){if(0!==T.length){var t=T.findIndex(function(t){return t.id===e});if(t>=0)return T[t].items}},I=function(e,t){if(0!==T.length){var n=T.findIndex(function(t){return t.id===Number(e)});if(n>=0){var i=T[n].items;if(n=i.findIndex(function(e){return e.id===Number(t)}),n>=0)return i[n]}}},B=function(e,t){for(var n="<section id='section' class='row'>",i=0,r=e.length;i<r;i++){var s=t;s=F(s,"name",e[i].name),s=F(s,"shortName",e[i].sName),n+=s}return n+="</section>"},D=function(e,t,n,i){n=F(n,"name",e.name),n=F(n,"specialInstructions",e.spInstruc);var r=n;r+="<section class='row'>";for(var s=0,o=t.length;s<o;s++){var a=i;a=F(a,"id",t[s].id),a=F(a,"idCourse",e.id),a=F(a,"shortName",t[s].sName),a=F(a,"catShortName",e.sName),a=O(a,"priceSmall",t[s].sPrice),a=q(a,"smallPortionName",t[s].sPortionName),a=O(a,"priceLarge",t[s].lPrice),a=q(a,"largePortionName",t[s].lPortionName),a=F(a,"name",t[s].name),a=F(a,"description",t[s].description),s%2!==0&&(a+="<div class='clearfix visible-lg-block visible-md-block'></div>"),r+=a}return r+="</section>",r+="<input type='button' id='basketButton' value='To Basket'>"},R=function(e,t,n,i,r){var s=t;s+="<section id='section' class='row'>";for(var o,a,d,u,l=0,c=0,m=r.length;c<m;c++)if(o=T[r[c].idCourse-1],a=r[c].dish){var p=e;p=F(p,"id",a.id),p=F(p,"idCourse",o.id),p=F(p,"name",a.name),p=F(p,"shortName",a.sName),p=O(p,"priceSmall",a.sPrice),p=q(p,"smallPortionName",a.sPortionName),p=O(p,"priceLarge",a.lPrice),p=q(p,"largePortionName",a.lPortionName),p=F(p,"catShortName",o.sName),p=F(p,"smallPortionQuantity",a.sPortionQuant),p=F(p,"largePortionQuantity",a.lPortionQuant),d=a.sPortionQuant*(null===a.sPrice?a.lPrice:a.sPrice),u=a.lPortionQuant*(null===a.lPrice?0:a.lPrice),l+=d+u,p=F(p,"smallPortionTotal","$"+d.toFixed(2)),null===a.sPrice?(p=F(p,"vis","hidden"),p=F(p,"largePortionTotal","")):p=F(p,"largePortionTotal","$"+u.toFixed(2)),s+=p}return s+="</section>",l>0&&(n=F(n,"orderPrice",l.toFixed(2)),n=F(n,"discount",i),n=F(n,"discOrderPrice",(l*(1-i/100)).toFixed(2)),s+=n),s},O=function(e,t,n){return n?(n="$"+n.toFixed(2),F(e,t,n)):F(e,t," ")},q=function(e,t,n){return n?(n="("+n+")",F(e,t,n)):F(e,t,"")},F=function(e,t,n){var i="{{"+t+"}}";return e=e.replace(new RegExp(i,"g"),n)},Q=function(e){if(0!==T.length){var t=T.findIndex(function(t){return t.id===e});if(t>=0)return T[t]}},A=function(e){Promise.all([w.getCourseHTML(),M(e)]).then(function(e){if(0===e[1].length)w.getCourseEmptyHTML().then(function(e){C.innerHTML=e});else{C.innerHTML=B(e[1],e[0]);var n=document.getElementById("section");n.addEventListener("click",t,!1)}})},G=function(e){Promise.all([E.getDishTitleHTML(),E.getDishHTML(),S(e)]).then(function(t){C.innerHTML=D(Q(e),t[2],t[0],t[1]);var n=document.getElementById("basketButton");n.addEventListener("click",i,!1)})},J=function(){var e=JSON.parse(localStorage.getItem("Order"));0===e.length?L.getBasketEmptyHTML().then(function(e){C.innerHTML=e}):Promise.all([L.getBasketHTML(),L.getBasketTitleHTML(),L.getBasketFooterHTML(),L.getDiscount(),M("menu.json")]).then(function(t){C.innerHTML=R(t[0],t[1],t[2],t[3],e);var n=document.getElementById("section"),i=document.getElementById("orderButton"),o=document.getElementById("modalForm");o.addEventListener("invalid",m,!0),n.addEventListener("click",r,!1),n.addEventListener("change",s,!1),i.addEventListener("click",d,!1);for(var a=C.getElementsByClassName("quantity"),u=0,l=a.length;u<l;u++)"hidden"===a[u].getAttribute("data-visibility")&&(a[u].style.visibility="hidden")})}});